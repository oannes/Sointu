{% extends "base.html" %}
{% block content %}
<h1>{{ _("Tulokset") }}</h1>

{% if selected_dt_files and selected_dt_files|length > 0 %}
  <div class="card" style="border-left:4px solid #4b9cdb">
    <strong>{{ _("Käytetyt DT-tiedostot") }}:</strong>
    <ul style="margin:6px 0 0 16px">
      {% for fn in selected_dt_files %}
        <li><code>{{ fn }}</code></li>
      {% endfor %}
    </ul>
    <small>{{ _("Valmisteltuja GPT-konteksteja") }}: {{ gpt_contexts_count }}</small>
  </div>
{% endif %}

<!-- 1) User-submitted message -->
<div class="card">
  <h3>{{ _("Syötetty viesti") }}</h3>
  <div style="white-space:pre-wrap">{{ user_text }}</div>
</div>

<!-- 2) GPT analysed key topics -->
<div class="card">
  <h3>{{ _("Keskeiset aiheet (GPT)") }}</h3>
  {% if topics and topics|length > 0 %}
    <p>{{ ", ".join(topics) }}</p>
  {% else %}
    <small>{{ _("Ei tunnistettuja aiheita.") }}</small>
  {% endif %}
</div>

<!-- 3) Three best fitting news items (last 2 weeks) + show more -->
<div class="card">
  <h3>{{ _("Sopivat uutiset (viimeiset 14 vrk)") }}</h3>
  <div class="list">
  {% for a in articles %}
    <div class="news-row">
      <div class="meta">
        <div class="title"><strong>{{ a.title }}</strong></div>
        <small>{{ a.publisher }}{% if a.published %} — {{ a.published }}{% endif %}</small>
      </div>
      {% if a.url %}
        <a href="{{ a.url }}" target="_blank" class="btn ghost sm">{{ _("Lue") }}</a>
      {% endif %}
    </div>
    {% if not loop.last %}<hr>{% endif %}
  {% endfor %}
  {% if not articles or articles|length == 0 %}
    <small>{{ _("Ei suoria uutisosumia (MVP).") }}</small>
  {% endif %}
</div>

<!-- 4) GPT analysis of how well the message resonates with key topics -->
<div class="card">
  <h3>{{ _("Resonanssianalyysi teemoista (GPT)") }}</h3>
  <div style="white-space:pre-wrap">{{ topic_resonance }}</div>
</div>

<!-- 5) Population resonance list -->
<div class="card">
  <h3>{{ _("Populaatiot & resonanssi") }}</h3>
  <div class="list">
  {% for r in results %}
    <div class="pop-row">
      <div class="meta">
        <strong>{{ r.name }}</strong>
        <div class="sub">
          <small>{{ _("Luottamus") }}: {{ (r.confidence*100)|round(0) }}%</small>
          <span class="dot">•</span>
          <small>{{ _("Pisteet") }}: {{ r.score }}/100</small>
        </div>
      </div>

      <div class="pill {{ r.decision|lower|replace('no-go','no-go') }}">
        {{ r.decision }}
      </div>

      {% if r.decision != "GO" %}
        <a class="btn sm cta" href="{{ url_for('pop_suggestions', pop_name=r.name) }}">
          {{ _("Katso suositukset resonanssin parantamiseksi") }}
        </a>
      {% else %}
        <span></span> {# pitää gridin tasapainossa, ei-näkyvä täyte #}
      {% endif %}
    </div>
    {% if not loop.last %}<hr>{% endif %}
  {% endfor %}
</div>
</div>

<!-- 6) Add new populations 
<div class="card">
  <h3>{{ _("Lisää populaatio") }}</h3>
  <form method="post" action="{{ url_for('add_population') }}" class="inline-form">
    <input type="text" name="new_population" placeholder="{{ _('Lisää uusi populaatio…') }}">
    <button type="submit" class="btn secondary">{{ _("Lisää") }}</button>
  </form>
</div>-->

{% endblock %}
